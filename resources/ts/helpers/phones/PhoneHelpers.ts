import { parsePhoneNumberFromString } from 'libphonenumber-js';

export class PhoneHelpers {
    static validateAndFormatPhoneToGlobal(phoneNumber: string): string | null {
        if (!phoneNumber) return 'invalid';

        // Удаляем все ненужные символы (пробелы, дефисы, скобки и другие)
        phoneNumber = phoneNumber.replace(/[^\d]/g, '');

        // Если номер не начинается с '+', добавляем '+'
        const phoneNumberWithPlus = phoneNumber.startsWith('+') ? phoneNumber : '+' + phoneNumber;

        // Парсим номер телефона
        const phoneNumberObj = parsePhoneNumberFromString(phoneNumberWithPlus);

        // Проверяем, является ли номер валидным
        if (!phoneNumberObj || !phoneNumberObj.isValid()) {
            return 'invalid';
        }

        // Получаем точную длину номера
        const nationalNumber = phoneNumberObj.nationalNumber;
        const nationalLength = nationalNumber.length;

        // Получаем страну для дальнейшей проверки длины
        const countryCode = phoneNumberObj.country;

        // Справочник длины номеров для разных стран
        const validLengths: { [key: string]: number[] } = {
            'US': [10],    // США: мобильный номер всегда 10 цифр
            'UA': [9, 10], // Украина: мобильные номера могут быть 9 или 10 цифр
            'GB': [10],    // Великобритания: 10 цифр для мобильных номеров
            'DE': [10],    // Германия: 10 цифр для мобильных номеров
            'FR': [9],     // Франция: мобильный номер обычно 9 цифр
            'IT': [9],     // Италия: 9 цифр для мобильных номеров
            'IN': [10],    // Индия: 10 цифр для мобильных номеров
            'RU': [10],    // Россия: 10 цифр для мобильных номеров
            'CN': [11],    // Китай: 11 цифр для мобильных номеров
            'AU': [9],     // Австралия: 9 цифр для мобильных номеров
            'BR': [11],    // Бразилия: 11 цифр для мобильных номеров
            'ZA': [10],    // Южноафриканская Республика: 10 цифр для мобильных номеров
            'AR': [10],    // Аргентина: 10 цифр для мобильных номеров
            'ES': [9],     // Испания: 9 цифр для мобильных номеров
            'PH': [10],    // Филиппины: 10 цифр для мобильных номеров
            'EG': [10],    // Египет: 10 цифр для мобильных номеров
            'ID': [10],    // Индонезия: 10 цифр для мобильных номеров
            'NG': [11],    // Нигерия: 11 цифр для мобильных номеров
            'MX': [10],    // Мексика: 10 цифр для мобильных номеров
            'KR': [11],    // Южная Корея: 11 цифр для мобильных номеров
            'JP': [10],    // Япония: 10 цифр для мобильных номеров
            'CO': [10],    // Колумбия: 10 цифр для мобильных номеров
            'CL': [9],     // Чили: 9 цифр для мобильных номеров
            'SG': [8],     // Сингапур: 8 цифр для мобильных номеров
            'TH': [9],     // Таиланд: 9 цифр для мобильных номеров
            'MY': [9],     // Малайзия: 9 цифр для мобильных номеров
            'KE': [10],    // Кения: 10 цифр для мобильных номеров
            'PK': [10],    // Пакистан: 10 цифр для мобильных номеров
            'VN': [10],    // Вьетнам: 10 цифр для мобильных номеров
            // Добавьте другие страны и их допустимые длины номеров по мере необходимости
        };

        // Проверяем длину национального номера
        if (validLengths[countryCode] && !validLengths[countryCode].includes(nationalLength)) {
            return 'invalid';
        }

        // Возвращаем отформатированный номер без пробелов и '+'
        return phoneNumberObj.formatInternational().replace(/\s+/g, '').replace('+', '');
    }
}
